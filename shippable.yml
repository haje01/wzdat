build_environment: Ubuntu 14.04

language: python

python:
    - "2.7"

before_install:
    - "sudo apt-get -qq -y install libatlas-base-dev gfortran libpng-dev  libfreetype6-dev libxft-dev"
    - "sudo apt-get -qq -y install libhdf5-serial-dev"

install: 
    #- "pip install numpy scipy matplotlib pandas pyzmq pygments ipython"
    #- "pip install cython==0.20.2"
    - "cat test_requirements.txt | xargs pip install"
    - "pip install ."
    - "pip install python-coveralls"

before_script:
    mkdir -p shippable/testresults
    mkdir -p shippable/codecoverage
    touch /var/log/wzdat
    chmod 777 /var/log/wzdat

script:
    - pwd
    - WZDAT_NO_CACHE=True WZDAT_DATA_DIR=/wzdat/tests/dummydata WZDAT_SOL_DIR=/wzdat/tests WZDAT_SOL_PKG=ws_mysol WZDAT_PRJ=myprj nosetests --with-xunit --xunit-file=shippable/testresults/nosetests.xml
    - coverage run --source=wzdat --branch setup.py test
    - coverage xml -o shippable/codecoverage/coverage.xml

after_success:
    #- coveralls
